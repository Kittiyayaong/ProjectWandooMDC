# Module 1 - Agentless container vulnerability assessment scanning

## ëª©í‘œ
ì´ Moduleì€ Microsoft Defender ì·¨ì•½ì„± ê´€ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ì—ì´ì „íŠ¸ ì—†ëŠ” ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì·¨ì•½ì„± í‰ê°€ ìŠ¤ìº”ì„ Azure ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ëŒ€í•´ ê²€ì¦í•˜ê³  ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

### âœ… Lab ë‚´ìš© ìš”ì•½
- **Lab ì „ì²´ íë¦„**  
  â” ì·¨ì•½ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ â” ACR ì—…ë¡œë“œ â” MDC CWPP í‰ê°€ â” Recommendations ê²°ê³¼ ìƒì„±

- **CWPP ê¸°ëŠ¥ ì—°ê³„**
  - **ACR Integration**: Azure Container Registry onboarding
  - **Agentless Scanning**: Defender for Cloudê°€ Qualys engineìœ¼ë¡œ ì´ë¯¸ì§€ í‰ê°€
  - **Recommendations**: ì·¨ì•½ì  ì‹ë³„ ë° remediation ì œì•ˆ

| **Lab ë‹¨ê³„** | **ì„¸ë¶€ ë‚´ìš©** | **ì—°ê³„ëœ CWPP ê¸°ëŠ¥** | **MDC ê²°ê³¼/ì¶œë ¥** |
|---|---|---|---|
| **Lab 1** | Docker Desktop ì„¤ì¹˜ | ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ ë° ê´€ë¦¬ ì¤€ë¹„ | N/A |
| **Lab 2 (Windows)** / **Lab 3 (Mac)** | DVWA ì·¨ì•½ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë° íƒœê·¸ â” ACRì— í‘¸ì‹œ | Container Image Onboarding<br>ACR Integration | ì´ë¯¸ì§€ê°€ ACRì— ì €ì¥ë¨ |
| **Lab 4** | MDCì—ì„œ Recommendations í™•ì¸ | Agentless Vulnerability Scanning (Qualys ê¸°ë°˜)<br>Container Image Vulnerability Assessment | `Container images in Azure registry should have vulnerability findings resolved` ê¶Œì¥ ì‚¬í•­ ìƒì„± |

### ì „ì œ ì¡°ê±´
ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ êµ¬ë…ì—ì„œ Defender for Containers ë˜ëŠ” Defender Cloud ë³´ì•ˆ ìì„¸ ê´€ë¦¬ ê¸°ëŠ¥ì„ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. 

MDC console > Management > Envorionment settings > í•˜ë‹¨ì— í…ŒìŠ¤íŠ¸ ëŒ€ìƒ Subscription ì´ë™ > Defender Plans > ìƒë‹¨ì— Settings & monitoring > Agentless scanning for machinesê°€ **on**ìœ¼ë¡œ ì„¤ì •ë˜ì–´ìˆëŠ”ì§€ í™•ì¸ 
![image](https://github.com/user-attachments/assets/5bca1492-0dbf-4b7f-b708-6fd6c7575d68)

---

### Lab 1: Install Docker Desktop
ë¨¼ì €, ê¸°ì¡´ Azure ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì·¨ì•½í•œ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë„ë¡ Docker Desktopì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

1.	[Docker](https://www.docker.com/products/docker-desktop)ë¡œ ì´ë™í•˜ì—¬ ë‹¤ìš´ë¡œë“œ í›„ installí•©ë‹ˆë‹¤. WindowsëŠ” 2ë²ˆ, Macì€ 3ë²ˆìœ¼ë¡œ ì´ë™í•´ì„œ ì§„í–‰í•©ë‹ˆë‹¤. 
2. Windows OS
2-1. Install í›„, Powershellì—ì„œ Docker versoinì„ í™•ì¸í•©ë‹ˆë‹¤.
```
    docker versionâ€‹
```
![image](https://github.com/user-attachments/assets/b5c03694-b619-4b8d-9296-715dbbacd972)

3. Mac OS
3-1. ì„¤ì¹˜ ì™„ë£Œ í›„, í„°ë¯¸ë„ì—ì„œ Docker ì‹¤í–‰ í™•ì¸

    ```bash
   docker version

<img width="682" alt="image" src="https://github.com/user-attachments/assets/72d354e0-1aa5-49c8-9c2a-358c7b7f9a28" />

---

### Lab 2: Windows - Docker Hubì—ì„œ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ ì·¨ì•½ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ

ì´ì œ Dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½í•œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³ , ì´ë¥¼ Lab 1ì˜ ARM í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•œ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ í‘¸ì‹œí•  ê²ƒì…ë‹ˆë‹¤.

1. Azure í¬í„¸ > Container registries > ìƒì„±í•œ container í´ë¦­ > Login Server ì´ë¦„ì„ ë³µì‚¬í•©ë‹ˆë‹¤. 
2. PowerShellì„ ì—´ê³  (ì—¬ê¸°ì„œ NameOfServerëŠ” ìœ„ì—ì„œ ë³µì‚¬í•œ ê²ƒì…ë‹ˆë‹¤) ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤: <br />

azure ê³„ì •ì— ë¡œê·¸ì¸í•©ë‹ˆë‹¤. 
```
az login
```
```
az acr login --name NameOfServer
```
![image](https://github.com/user-attachments/assets/f75cf333-e51f-4d6e-8f60-37ef629219e1)

> â­ Tips: <br>
> ì•„ì§ Azure CLIë¥¼ ì„¤ì¹˜í•˜ì§€ ì•Šì€ ê²½ìš° https://docs.microsoft.com/en-us/cli/azure/install-azure-cli ë¥¼ ë°©ë¬¸í•˜ì—¬ ì§€ì¹¨ì„ í™•ì¸í•˜ì„¸ìš”. ë˜í•œ ìœ„ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ì „ì— *az ë¡œê·¸ì¸*ì„ í†µí•´ Azure êµ¬ë…ì— ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

3. ë„ì»¤ í—ˆë¸Œì—ì„œ ì·¨ì•½í•œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”(ìì„¸í•œ ë‚´ìš©ì€ https://hub.docker.com/r/vulnerables/web-dvwa/ ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)

Powershellì—ì„œ ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:
```
docker pull vulnerables/web-dvwa
```
![image](https://github.com/user-attachments/assets/3e5808a2-8df5-47b9-baa3-d5dc6e9d0f4a)

4. ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ë¡œì»¬ ì €ì¥ì†Œì˜ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤:
```
docker images vulnerables/web-dvwa
```
![image](https://github.com/user-attachments/assets/9a810a4e-0a48-4634-88a2-fa5b2dfe694c)

5. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ì´ë¯¸ì§€ì˜ ë³„ì¹­ì„ ë§Œë“­ë‹ˆë‹¤(ìœ„ì—ì„œ ë³µì‚¬í•œ ì„œë²„ ì´ë¦„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.)
```
docker tag vulnerables/web-dvwa <ì„œë²„ëª…>.azurecr.io/vulnerables/web-dvwa
```

6. ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ë¡œì»¬ ì €ì¥ì†Œì˜ ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”: 
```
docker images ,ì„œë²„ëª…>.azurecr.io/vulnerables/web-dvwa
```
![image](https://github.com/user-attachments/assets/55dd54fa-2bef-43bd-8f91-d9468920ea7f)

7. ë„ì»¤ í‘¸ì‹œë¥¼ ì‹¤í–‰í•˜ì—¬ ìƒˆ ì´ë¯¸ì§€ë¥¼ azure ì €ì¥ì†Œì— ì—…ë¡œë“œí•˜ê³  ì•„ë˜ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ìŠ¤ìº”ì„ ìƒì„±í•©ë‹ˆë‹¤(ì‹œê°„ì´ ì¢€ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)<br />
```
docker push ,ì„œë²„ëª…>.azurecr.io/vulnerables/web-dvwa
```
![image](https://github.com/user-attachments/assets/8412d3c5-d97f-4c17-8f9f-93d8dbb4d8af)


8. azure portal > container registires > WandooContainer > Repositoriesì—ì„œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
![image](https://github.com/user-attachments/assets/78f2aaac-c9c1-4bc0-b058-50e17f3a7eb6)

> â­ Tips: <br>
> **Damn Vulnerable Web Application (DVWA)**ëŠ” ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ìì‹ ì˜ ê¸°ìˆ ê³¼ ë„êµ¬ë¥¼ í•©ë²•ì ì¸ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ ë•ê¸° ìœ„í•´ ì„¤ê³„ëœ PHP/MariaDB ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. DVWAëŠ” ë‹¤ì–‘í•œ ë‚œì´ë„ì˜ ì¼ë°˜ì ì¸ ì›¹ ì·¨ì•½ì ì„ ì—°ìŠµí•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì†Œí”„íŠ¸ì›¨ì–´ì—ëŠ” ì˜ë„ì ìœ¼ë¡œ ë¬¸ì„œí™”ëœ ì·¨ì•½ì ê³¼ ë¬¸ì„œí™”ë˜ì§€ ì•Šì€ ì·¨ì•½ì ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì‚¬ìš©ìëŠ” ê°€ëŠ¥í•œ ë§ì€ ë¬¸ì œë¥¼ ë°œê²¬í•˜ê³  í•´ê²°í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤

---

### Lab 3: Mac - Docker Hubì—ì„œ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ ì·¨ì•½ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ

âœ… Azure CLI ì„¤ì¹˜ (ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš°ëŠ” 2ë²ˆìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.)

#### 1. homebrew

1-1. homebrew ì„¤ì¹˜ í™•ì¸

```bash
brew --version
```

1-2. ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°? 

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

1-3. homebrew ì—…ë°ì´íŠ¸
```bash
brew update
```

<img width="682" alt="image" src="https://github.com/user-attachments/assets/f28f80f5-f953-4fbf-b41a-495242e616b3" />

#### 2. azure cli

2-1. ì„¤ì¹˜
```bash
brew install azure-cli
```

2-2. Azure CLI ì„¤ì¹˜ í™•ì¸
```bash
az --version
```

<img width="682" alt="image" src="https://github.com/user-attachments/assets/04dbea37-e205-4edd-ad61-49c9c0c65b88" />

2-2. Azure CLI ë¡œê·¸ì¸: ë¸Œë¼ìš°ì €ê°€ ì—´ë¦¬ë©´ Azure ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
```bash
az login
```

#### 3. Azure Container Registry

3-1. ë¡œê·¸ì¸
```bash
az acr login --name <YourContainerRegistryName>
```
> ì˜ˆì‹œ
> ```bash
> az acr login --name wandootestcontainer
> ```

#### Docker
4-1. Docker ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸
```bash
docker --version
```

#### 5. Docker Hubì—ì„œ ì·¨ì•½ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í›„ ACRì— ì—…ë¡œë“œ

5-1. ì·¨ì•½ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
```bash
docker pull vulnerables/web-dvwa
```

5-2. ë¡œì»¬ ì´ë¯¸ì§€ í™•ì¸
```bash
docker images vulnerables/web-dvwa
```

5-3. ì´ë¯¸ì§€ íƒœê·¸ ë³€ê²½ (ACRìš©)
```bash
docker tag vulnerables/web-dvwa <YourContainerRegistryName>.azurecr.io/vulnerables/web-dvwa
```

5-4. íƒœê·¸ ë³€ê²½ëœ ì´ë¯¸ì§€ í™•ì¸
```bash
docker images <YourContainerRegistryName>.azurecr.io/vulnerables/web-dvwa
```

5-5. ì´ë¯¸ì§€ ACRë¡œ í‘¸ì‹œ
```bash
docker push <YourContainerRegistryName>.azurecr.io/vulnerables/web-dvwa
```

#### 6. Azure Portalì—ì„œ ì—…ë¡œë“œ í™•ì¸

Azure Portal â” Container Registries â” ë³¸ì¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ â” Service â” Repositories â” vulnerables/web-dvwa ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸

<img width="1429" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-07-06 á„‹á…©á„’á…® 1 59 33" src="https://github.com/user-attachments/assets/389f1236-1a37-425d-924a-06b044096278" />

> â­ï¸ Tips. DVWAë€? (Damn Vulnerable Web Application (DVWA))
>
> * ì˜ë„ì ìœ¼ë¡œ ì·¨ì•½í•œ PHP/MariaDB ì›¹ì•±
> * ë³´ì•ˆ í›ˆë ¨ ë° ëª¨ì˜ í•´í‚¹ ì—°ìŠµìš©
> * [DVWA Docker Hub](https://hub.docker.com/r/vulnerables/web-dvwa/)

---

### Lab 4: ACRì˜ ì·¨ì•½ì ì— ëŒ€í•œ ê¶Œì¥ ì‚¬í•­ ì¡°ì‚¬
ì·¨ì•½í•œ ì´ë¯¸ì§€ê°€ Azure ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ í‘¸ì‹œë˜ë©´ Microsoft Defender for CloudëŠ” Microsoft Defender ì·¨ì•½ì„± ê´€ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ì— ì·¨ì•½ì„±ì´ ìˆëŠ”ì§€ ìŠ¤ìº”í•˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ì´ì œ Microsoft Defender for Cloudì˜ ê¶Œì¥ ì‚¬í•­ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

1. MDC > recommendations > Resource type í•„í„°ë¥¼ **Container Image**ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
![image](https://github.com/user-attachments/assets/b6a17f11-bb99-4bd2-ae8b-8357fd9fa9db)

2.  **Container images in Azure registry should have vulnerability findings resolved** ë¼ëŠ” recommendationì„ ì°¾ì•„ì„œ ë¦­í•˜ë©´ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Attected resourceëŠ” web-dvwaì¸ í•­ëª©ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤. 
3.  ê¶Œì¥ ì‚¬í•­ì— ìˆëŠ” ë‚´ìš©ì„ í™•ì¸í•©ë‹ˆë‹¤. 

    ![image](https://github.com/user-attachments/assets/8b4086c1-8d90-4ff6-ac0d-76b409423d19)



### ğŸ”— [ë‹¤ìŒ Labìœ¼ë¡œ ì´ë™í•˜ê¸° Â»](https://github.com/Kittiyayaong/ProjectWandooMDC/blob/main/CWPP%20-%20Module02.%20Onboarding%20Azure%20DevOps%20to%20Defender%20for%20Cloud.md)
